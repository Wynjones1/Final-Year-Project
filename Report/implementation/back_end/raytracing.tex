\section{Raytracing}
\subsection{Pixel Sampling}
As the raytracer is performing distribution raytracing each thread will perform multiple raytracing operations for each pixel
that it processes each sample per pixel is offset inside the pixel to perform antialiasing, this reduces the sharp edges that
can be seen in images. In order to improve the appearence of the image we also perform jittering on the samples this reduces
certain artifacts such as banding. \todo{Make sure the banding comment is correct and if so find a reference for it}

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.4\textwidth}
	\includegraphics[width=\textwidth]{./images/renders/no-aa.png}
	\caption{1 ray per pixel}
\end{subfigure}
\begin{subfigure}[b]{0.4\textwidth}
	\includegraphics[width=\textwidth]{./images/renders/aa.png}
	\caption{25 rays per pixel}
\end{subfigure}
\end{figure}
\subsection{Intersection Tests (0.5 pages)}

Intersection tests are another vital part of any raytracer. a number of intersection tests are needed, I will not include
an extensive treatment of the intersection tests mearly a listing of the most notable used.

\begin{description}
\item[Triangle] Moller-Trumbore intersection test \cite{MolTru97}
\item[AABB]
\item[kD-tree] As described in TODO:
\end{description}

\subsubsection{Self Intersection}
Due to the floating point errors in the calculation of intersection tests the point of intersection that is reported may be
slightly incorrect, this inaccuracy can cause issues for reflection, transmission and shadows as the intersection of the
specular or shadow ray reports an intersection point close to the original intersection point, this can cause artifacts in
the final render, to remedy this issue we use a small offset in the direction of the incident ray so that the origin of the
new ray is slightly above the intersection point.

\subsection{volume intersection}
Unlike intersection with all other object types the intersection with a participating media is non deterministic, this is
due to the fact that the intersection of the ray is determined by the extinction coefficient which gives a probablilty
of interaction, the depth of the interaction is calculated with equation \todo{add equation}, performing this non-deterministic
intersection test allows for objects within the medium to be interacted with when performing ray-marching.

\missingfigure{Non-deterministic intersection test}

\subsection{Intersection Storage}
When raytracing the scene the intersection point of the ray needs to be calculated and stored, this will include data that
is specific to an objects intersection, for example an intersection with a triangle mesh will need to record the trangle
that was intersected and as a result will need to record the barycentric coordinate at the point of intersection.

\subsection{Scene Traversal}
\begin{algorithm}
\begin{algorithmic}
\caption{Scene Traversal Algorithm}
\State colour $\gets$ scene.sky\_colour
\For{object $\in$ scene}

	new\_record $\gets$ intersects(ray, object)

	\If{new\_record.hit \textbf{and} new\_record.t $\textless$ record.t}

	record $\gets$ new\_record

	\EndIf

\EndFor

\If{record.hit}

	colour $\gets$ shade(scene, record)
\EndIf

\Return colour

\end{algorithmic}
\end{algorithm}

\newpage
\input{./implementation/back_end/shading.tex}
\newpage
\input{./implementation/back_end/participating_media.tex}
